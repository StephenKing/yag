{namespace yag=Tx_Yag_ViewHelpers}
{namespace extlist=Tx_PtExtlist_ViewHelpers}

<extlist:comment>
<!--  
Template for rendering the category manager

Here is a list of objects / variables that can be accessed in this template:


@package YAG
@author Michael Knoll <mimi@kaktusteam.de>
@author Daniel Lienert <daniel@lienert.cc>
-->
</extlist:comment>

<f:layout name="Default" />
<f:section name="main">
	<script type="text/javascript">
	
	//Ext.BLANK_IMAGE_URL = '<?php echo $html->url('/js/ext-2.0.1/resources/images/default/s.gif') ?>';
	
	Ext.onReady(function(){
			        
	    var baseRequest = {extensionName:'yag',pluginName:'pi1',controllerName:'Category'};

	    Ext.getUrlParam = function(param) {
    	   var params = Ext.urlDecode(location.search.substring(1));
    	   return param ? params[param] : params;
    	};
	    
		function buildRequest(action) {
			var actionRequest = baseRequest;
			actionRequest.actionName = action;
			return actionRequest;
		}
	    
	    var Tree = Ext.tree;

		var Tree_Category_Loader = new Tree.TreeLoader({
	        dataUrl:"ajax.php",
	        baseParams: {
	        	id: Ext.getUrlParam('id'),
	        	ajaxID: 'yagAjaxDispatcher',
				request: Ext.encode(buildRequest('getSubTree')),
	        }
	    });
	    
	    var yagCategoryTree = new Tree.TreePanel({
	        el:'categoryTreeDiv',
	        autoScroll:true,
	        animate:true,
	        enableDD:true,
	        containerScroll: true,
	        rootVisible: true,
	        loader: Tree_Category_Loader,
	        tbar : [
	                {
	                    xtype : 'button' , text : 'Add new Category', 
	                    handler : function(){ 

	                        var selectedItem = yagCategoryTree.getSelectionModel().getSelectedNode();

	                            if(!selectedItem){

	                                selectedItem = yagCategoryTree.getRootNode();
	                            }

	                            handleCreate = function(btn, text,cBoxes){
	                                if(btn=='ok' && text){
                                        var newNode = new Ext.tree.TreeNode ({
                                                id : 'new',
                                                text : text,
                                        });

                                        if(selectedItem.isLeaf()) {
                                            selectedItem.parentNode.insertBefore(newNode, selectedItem.nextSibling);
                                        } else {
                                            selectedItem.insertBefore(newNode, selectedItem.firstChild);
                                            selectedItem.expand();
                                        }
	                                }

	                            }
	                        Ext.MessageBox.show({
	                            title:'Add a new Category',
	                            msg: 'Category Name:',
	                            buttons: Ext.MessageBox.OKCANCEL,
	                            prompt:true,
	                            fn: handleCreate
	                        });
	                        }

	                }

	            ],
		        
	    });
	    
	    var root = new Tree.AsyncTreeNode({
	        text:'Categories',
	        draggable:false,
	        id:'root'
	    });
	    yagCategoryTree.setRootNode(root);
	    
	    yagCategoryTree.render();
	    root.expand();
	
	});
	
	</script>
	
	<div id="categoryTreeDiv" style="height:200px; width:200px;"></div>
	<div id="categoryEditDiv" style="height:200px; width:300px;">
		<f:form.textField name="name" />
		<f:form.textArea name="description" rows="3" cols="10"/>
	</div>
	
</f:section>

<f:section name="beButtonsLeft">
</f:section>